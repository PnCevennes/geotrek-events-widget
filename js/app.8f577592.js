(function(t){function e(e){for(var r,i,o=e[0],u=e[1],c=e[2],d=0,p=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&p.push(n[i][0]),n[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);l&&l(e);while(p.length)p.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],r=!0,o=1;o<a.length;o++){var u=a[o];0!==n[u]&&(r=!1)}r&&(s.splice(e--,1),t=i(i.s=a[0]))}return t}var r={},n={app:0},s=[];function i(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=r,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(a,r,function(e){return t[e]}.bind(null,r));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/geotrek-events-widget/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var l=u;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);var r=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{attrs:{id:"app"}},[a("router-view")],1)},s=[],i=a("2877"),o=a("6544"),u=a.n(o),c=a("7496"),l={},d=Object(i["a"])(l,n,s,!1,null,null,null),p=d.exports;u()(d,{VApp:c["a"]});var h=a("f309");r["a"].use(h["a"]);var v=new h["a"]({}),_=a("8c4f"),g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[a("v-row",{attrs:{justify:"space-around"}},[a("v-card",{staticClass:"pa-0",attrs:{width:"400"}},[t.widget_header?a("v-img",{attrs:{height:"200px",src:"https://cdn.pixabay.com/photo/2020/07/12/07/47/bee-5396362_1280.jpg"}},[a("v-card-title",{staticClass:"white--text mt-8"},[a("p",{staticClass:"ml-3"},[t._v(" Animations Ã  venir ")])])],1):t._e(),a("v-card-text",{staticClass:"pa-0"},[t.loading?a("v-progress-linear",{attrs:{color:"deep-purple accent-4",indeterminate:"",rounded:"",height:"6"}}):t._l(t.events,(function(e){return a("a",{key:e.id,staticClass:"mb-3",attrs:{href:t.gtr_url+"/event/"+e.id,target:"_blank"}},[a("v-hover",{scopedSlots:t._u([{key:"default",fn:function(r){var n=r.hover;return[a("v-card",{staticClass:"mx-auto d-flex align-end flex-column card-hover",class:{"on-hover":n},attrs:{outlined:"",elevation:n?24:0}},[a("v-card-text",{staticClass:"pa-0"},[a("v-list-item",{staticClass:"px-1",attrs:{"three-line":""}},[a("v-list-item-avatar",{staticClass:"my-1",attrs:{tile:"",size:"80",color:"grey"}},[a("v-img",{attrs:{src:t.get_thumb(e["attachments"]||[])}})],1),a("v-list-item-content",{staticClass:"py-0"},[a("div",[a("v-avatar",{staticClass:"mr-1",attrs:{color:t.evt_color,size:"32px"}},[a("img",{attrs:{src:t.eventsType[e.type].picto,title:t.eventsType[e.type].name}})]),a("strong",[t._v(t._s(e.name.fr)+" ")])],1),e.begin_date_f!==e.end_date_f?a("span",[t._v(" du "+t._s(e.begin_date_f)+" au "+t._s(e.end_date_f)+" ")]):a("span",[t._v("le "+t._s(e.begin_date_f)+" ")])])],1)],1)],1)]}}],null,!0)})],1)}))],2)],1)],1)],1)},f=[],y={data:()=>({events:[],eventsType:{},eventsStore:[],display_nb:void 0,loading:!0,gta_query_params:{},evt_icone:"mdi-calendar-text",evt_color:"orange",widget_header:!0}),mounted(){if(this.gta_url=this.$route.query.gta_url||"https://geotrek-admin.cevennes-parcnational.net",this.gtr_url=this.$route.query.gtr_url||"https://destination.cevennes-parcnational.fr",this.event_api_url=this.gta_url+"/api/v2/touristicevent/?fields=id,begin_date,end_date,type,name,attachments",this.evt_icone=this.$route.query.icone||"mdi-calendar-text",this.evt_icone.startsWith("mdi-")||(this.evt_icone="mdi-"+this.evt_icone),this.evt_color=this.$route.query.color||"orange",this.$route.query.nb_days){const t=new Date;let e=new Date;e.setDate(t.getDate()+parseInt(this.$route.query.nb_days)),this.gta_query_params["dates_after"]=t.toISOString().split("T")[0],this.gta_query_params["dates_before"]=e.toISOString().split("T")[0]}this.widget_header="true"===this.$route.query.widget_header,this.$route.query.display_nb&&(this.display_nb=this.$route.query.display_nb),["in-bbox","cities","districts","structures","themes","portals","types"].forEach(t=>{t in this.$route.query&&(this.gta_query_params[t]=this.$route.query[t])}),this.getEvents()},watch:{loading(t){!1===t&&(this.events=this.eventsStore.map(t=>({...t,date:new Date(t.begin_date)})).sort((t,e)=>Number(t.date)-Number(e.date)),this.display_nb&&(this.events=this.events.slice(0,this.display_nb)),this.events=this.events.map(t=>({...t,begin_date_f:new Date(t.begin_date).toLocaleDateString(),end_date_f:new Date(t.end_date).toLocaleDateString()})))}},methods:{get_thumb(t){if(t.length>0)return t[0].thumbnail},requestNextPage(t){return fetch(t,{method:"GET"}).then(t=>t.json()).then(t=>{this.processEventData(t)}).catch(t=>{console.log("Error: "+t)})},processEventData(t){this.eventsStore.push(...t.results),t.next?this.requestNextPage(t.next):this.getEventsType()},getEventsType(){fetch(this.gta_url+"/api/v2/touristicevent_type").then(t=>t.json()).then(t=>{t.results.forEach(t=>{this.eventsType[t.id]={picto:t.pictogram,name:t.type.fr}}),console.log(this.eventsType),this.loading=!1})},getEvents(){const t=Object.keys(this.gta_query_params).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(this.gta_query_params[t])).join("&");fetch(this.event_api_url+"&"+t).then(t=>t.json()).then(t=>{this.processEventData(t)})}}},m=y,b=(a("ad10"),a("8212")),w=a("b0af"),x=a("99d9"),q=a("a523"),j=a("ce87"),C=a("adda"),O=a("da13"),T=a("8270"),S=a("5d23"),E=a("8e36"),$=a("0fd9"),V=Object(i["a"])(m,g,f,!1,null,"2a4da08e",null),D=V.exports;u()(V,{VAvatar:b["a"],VCard:w["a"],VCardText:x["a"],VCardTitle:x["b"],VContainer:q["a"],VHover:j["a"],VImg:C["a"],VListItem:O["a"],VListItemAvatar:T["a"],VListItemContent:S["a"],VProgressLinear:E["a"],VRow:$["a"]}),r["a"].use(_["a"]);const k=[{path:"/",name:"GTEvents",component:D,query:{gta_url:"https://geotrekdemo.ecrins-parcnational.fr"}}],P=new _["a"]({mode:"history",base:"/geotrek-events-widget/",routes:k});var I=P;r["a"].config.productionTip=!1,new r["a"]({vuetify:v,router:I,render:t=>t(p)}).$mount("#app")},"90c6":function(t,e,a){},ad10:function(t,e,a){"use strict";a("90c6")}});
//# sourceMappingURL=app.8f577592.js.map